<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
		crossorigin="anonymous"></script>
	<link rel="stylesheet" href="styles.css" />
	<script>
		function disableAccordionElement(element) {
			const links = [document.getElementById("overviewLink"), document.getElementById("buildingsLink"), document.getElementById("locationsLink")];
			links.forEach(e => {
				if (e.classList.contains("disabled")) {
					e.classList.toggle("disabled")
				}
			});
			element.classList.toggle("disabled");
		}
	</script>
</head>

<body>
	<div class="container p-2 d-flex vh-100 flex-column">
		<div class="row dark-purple gx-3" id="top-row">
			<div class="col-sm-3 p-2">LOGO HERE</div>
			<div class="col-sm-4 p-2">

				<ul class="breadcrumb">
					<li><a href="index.html">Home</a> &nbsp; | &nbsp;</li>
					<li class="active">CK3 &nbsp; | &nbsp;</li>
					<li><a href="V3.html">V3</a> &nbsp; | &nbsp;</li>
					<li><a href="EUIV.html">EUIV</a></li>
				</ul>
			</div>
			<div class="col-sm-10"></div>
		</div>
		<div class="row gx-5 h-75  overflow-auto" id="main">
			<div class="col-xs-3 col-lg-3 p-3 h-100" id="side-bar">
				<div class="light-purple p-2 overflow-auto h-100">
					<ul class="no-bullet">
						<li><button type="button" class="btn btn-link disabled" data-bs-toggle="collapse"
								data-bs-target="#overview" data-bs-parent="#subPage" aria-expanded="true"
								id="overviewLink" onclick="disableAccordionElement(this)">Overview</button></li>
						<li><button type="button" class="btn btn-link" data-bs-toggle="collapse"
								data-bs-target="#buildings" data-bs-parent="#subPage" aria-expanded="false"
								id="buildingsLink" onclick="disableAccordionElement(this)">Buildings</button></li>
						<li><button type="button" class="btn btn-link" data-bs-toggle="collapse"
								data-bs-target="#locations" data-bs-parent="#subPage" aria-expanded="false"
								id="locationsLink" onclick="disableAccordionElement(this)">Locations</button></li>
					</ul>
				</div>
			</div>
			<div class="col-xs-9 col-lg-9 p-3 h-100" id="content">
				<div class="p-2 medium-purple overflow-auto h-100">
					<div id="subPage">
						<!-- <button data-bs-toggle="collapse" data-bs-target="#buildings"
							data-bs-parent="#subPage">Buildings</button>
						<button data-bs-toggle="collapse" data-bs-target="#locations"
							data-bs-parent="#subPage">Locations</button> -->
						<div class="accordion-group">
							<div class="collapse show" id="overview" data-bs-parent="#subPage">
								This page is about maximizing the number and effectiveness of your knights as a
								duke-rank character.
								Since dukes don't get a vassal opinion penalty for more than two duchies, you can have
								as many duchy
								buildings as your domain limit allows. However, if your realm size exceeds 30 you get
								penalties to
								your tax income.

								While the overextension penalty for going above 30 realm size as a duke (or count) is
								not a hard cap, for simplicity I'll assume we won't be exceeding it.

								In general, you want duchies with as few counties as possible, since you want to
								hold at least 50% of the de jure territory to
								prevent anyone from usurping the title from you. Large duchies mean you or your
								vassals need to own more counties, increasing
								your realm size, or you need other means to prevent usurpation (like the rest of the
								duchy being held by characters of hostile religions).

								Furthermore, you want the capital barony of the county to be able to build a
								terrain-dependent
								building that gives you more knights and/or knight effectiveness.


							</div>
							<div class="collapse" id="buildings" data-bs-parent="#subPage">
								There are several non-special buildings that give you knights and knight effectiveness
								(figures at
								max level):
								<div class="table-responsive">
									<table class="table table-dark">
										<thead>
											<tr>
												<th scope="col"></th>
												<th scope="col">Military Academies</th>
												<th scope="col">Camelry</th>
												<th scope="col">Elephantry</th>
												<th scope="col">Regimental Camps</th>
											</tr>
											<tr>
												<th scope="row">Knights</th>
												<td>6</td>
												<td>4</td>
												<td>4</td>
												<td>1</td>
											</tr>
											<tr>
												<th scope="row">Knight effectiveness</th>
												<td>75%</td>
												<td>5%</td>
												<td>16%</td>
												<td>0%</td>
											</tr>
										</thead>
									</table>
								</div>
								Before late medieval, regimental camps won't give knights. Tables for tribal, early
								medieval, and
								high medieval, assuming all techs from the era in question and as upgraded as tech
								allows (assumes
								feudal buildings, including in tribal era): <br>
								<button class="btn btn-primary" type="button" data-bs-toggle="collapse"
									data-bs-target="#tribalTable" aria-expanded="false"
									aria-controls="tribalTable">Tribal</button>
								<button class="btn btn-primary" type="button" data-bs-toggle="collapse"
									data-bs-target="#earlyTable" aria-controls="earlyTable">Early
									Medieval</button>
								<button class="btn btn-primary" type="button" data-bs-toggle="collapse"
									data-bs-target="#highTable" aria-controls="highTable">High
									Medieval</button>
								<div class="collapse" id="tribalTable">
									Tribal (level 2 buildings, no duchy building available)
									<div class="table-responsive">
										<table class="table table-dark">
											<thead>
												<tr>
													<th scope="col"></th>
													<th scope="col">Camelry</th>
													<th scope="col">Elephantry</th>
												</tr>
												<tr>
													<th scope="row">Knights</th>
													<td>1</td>
													<td>1</td>
												</tr>
												<tr>
													<th scope="row">Knight effectiveness</th>
													<td>0%</td>
													<td>4%</td>
												</tr>
											</thead>
										</table>
									</div>
								</div>

								<div class="collapse" id="earlyTable">
									Early Medieval (level 4 buildings, level 1 duchy building)
									<div class="table-responsive">
										<table class="table table-dark">
											<thead>
												<tr>
													<th scope="col"></th>
													<th scope="col">Military Academies</th>
													<th scope="col">Camelry</th>
													<th scope="col">Elephantry</th>
												</tr>
												<tr>
													<th scope="row">Knights</th>
													<td>2</td>
													<td>2</td>
													<td>2</td>
												</tr>
												<tr>
													<th scope="row">Knight effectiveness</th>
													<td>25%</td>
													<td>0%</td>
													<td>8%</td>
												</tr>
											</thead>
										</table>
									</div>
								</div>

								<div class="collapse" id="highTable">
									High Medieval (level 6 buildings, level 2 duchy building)
									<div class="table-responsive">
										<table class="table table-dark">
											<thead>
												<tr>
													<th scope="col"></th>
													<th scope="col">Military Academies</th>
													<th scope="col">Camelry</th>
													<th scope="col">Elephantry</th>
												</tr>
												<tr>
													<th scope="row">Knights</th>
													<td>4</td>
													<td>3</td>
													<td>3</td>
												</tr>
												<tr>
													<th scope="row">Knight effectiveness</th>
													<td>50%</td>
													<td>5%</td>
													<td>12%</td>
												</tr>
											</thead>
										</table>
									</div>
								</div>
								<!-- buildings -->
							</div>
							<div class="collapse" id="locations" data-bs-parent="#subPage">
								<p>

									Secondly, you want the de jure capital barony of the de jure capital county of the
									duchy to have a terrain that lets you build either
									a camelry or an elephantry.
								</p>
								<p>
									To figure this out, we first need to have a list of titles in the game (found in
									game/common/landed_titles/00_landed_titles.txt) in a format
									we can parse. Fortunately, the
									<a href="https://github.com/nickbabcock/jomini">Jomini</a> library can help with
									that. We also want to know province terrain, so we also need to parse
									game/common/province_terrain/00_province_terrain.txt. Using Node.js (remove the
									non-titular titles at the beginning of the file first):
								<pre><code>import { Jomini } from "jomini";

import * as fs from 'fs'

const landedTitles = fs.readFileSync('./00_landed_titles_nontitular.txt', 'utf8');
/* console.log(landedTitles.length) */
const parser = await Jomini.initialize();
const out = parser.parseText(landedTitles);
/* console.log(out[0]);
console.log(typeof out); */
fs.writeFileSync('./landed_titles_nontitular.json', JSON.stringify(out));
const provinceTerrain = fs.readFileSync('./00_province_terrain.txt', 'utf8');
const provTerr = parser.parseText(provinceTerrain);
fs.writeFileSync('./province_terrain.json', JSON.stringify(provTerr));
export { out };	</code></pre>

								The rest is fairly simple. I'm currently using a python script to filter for appropriate
								duchies.
								Unfortunately I haven't spent much time on improving the quality and readability of the
								code
								since I intended it for personal use. <br>
								<button class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#horror">
									View code
								</button>
								<div class="collapse" id="horror">
									<pre><code>import json

f_terrain = open('province_terrain.json')
terrain_data = json.load(f_terrain)

f_titles = open('landed_titles_nontitular.json')
title_data = json.load(f_titles)
top_level_title_names = list(title_data.keys())
titles = []
top_level_titles = title_data
secondary_level_title_names = []
secondary_level_titles = {}
for name in top_level_title_names:
	keys = list(title_data[name].keys())
	filtered_keys = []
	for key in keys:
		if (key.startswith('k_')):
			filtered_keys.append(key)
	secondary_level_title_names += filtered_keys
	for key in filtered_keys:
		secondary_level_titles[key] = title_data[name][key]
# print("SECONDARY LEVEL TITLES")
# print(secondary_level_title_names)


duchy_names = []
duchy_titles = {}
for name in secondary_level_title_names:
	keys = list(secondary_level_titles[name].keys())
	filtered_keys = []
	for key in keys:
		if (key.startswith('d_')):
			filtered_keys.append(key)
	duchy_names += filtered_keys
	for key in filtered_keys:
		duchy_titles[key] = secondary_level_titles[name][key]
# print("DUCHY TITLES")
# print(duchy_names)

county_names = []
county_titles = {}
duchy_counties = {}
for name in duchy_names:
	keys = list(duchy_titles[name].keys())
	filtered_keys = []
	num_counties = 0
	for key in keys:
		if (key.startswith('c_')):
			filtered_keys.append(key)
			num_counties += 1
	county_names += filtered_keys
	duchy_titles[name]['num_counties'] = num_counties
	duchy_counties[name] = filtered_keys
	for key in filtered_keys:
		county_titles[key] = duchy_titles[name][key]

# print(duchy_titles['d_svealand'])
barony_names = []
barony_titles = {}
county_baronies = {}
for name in county_names:
	keys = list(county_titles[name].keys())
	filtered_keys = []
	for key in keys:
		if (key.startswith('b_')):
			filtered_keys.append(key)
	barony_names += filtered_keys
	county_baronies[name] = filtered_keys
	for key in filtered_keys:
		barony_titles[key] = county_titles[name][key]


def get_duchies(title_data):
	return null


""" def get_capital_barony_terrain(empire_name, kingdom_name, duchy_name):
	duchy = title_data[empire_name][kingdom_name][duchy_name]
	capital_county_name = duchy['capital']
	capital_county = duchy[capital_county_name]
	capital_barony_name = list(capital_county)[1]
	capital_barony = capital_county[capital_barony_name]
	capital_barony_id = capital_barony['province']
	capital_barony_terrain = terrain_data[str(capital_barony_id)]
	return capital_barony_terrain """


def get_capital_barony_terrain(duchy_name):
	duchy = duchy_titles[duchy_name]
	if 'capital' in duchy:
		capital_county_name = duchy['capital']
	else:
		capital_county_name = duchy_counties[duchy_name][0]
	capital_county = duchy[capital_county_name]
	capital_barony_name = county_baronies[capital_county_name][0]
	capital_barony = capital_county[capital_barony_name]
	capital_barony_id = capital_barony['province']
	if (str(capital_barony_id) in terrain_data):
		if (isinstance(terrain_data[str(capital_barony_id)], str)):
			capital_barony_terrain = terrain_data[str(capital_barony_id)]
		elif (isinstance(terrain_data[str(capital_barony_id)], list)):
			capital_barony_terrain = terrain_data[str(capital_barony_id)][len(
				terrain_data[str(capital_barony_id)])-1]
	else:
		capital_barony_terrain = 'undefined'
	return capital_barony_terrain


# print(get_capital_barony_terrain('d_svealand'))

# print(duchy_names)


def get_duchies_with_terrain_capitals(terrain):
	matches = []
	for name in duchy_names:
		capital_barony_terrain = get_capital_barony_terrain(name)
		# print('duchy: '+name+', capital terrain: '+capital_barony_terrain)
		if (capital_barony_terrain == terrain):
			# print(name)
			matches.append(name)
	# print(jungle)
	return matches


""" def get_duchies_with_jungle_capitals():
	jungle = []
	for name in duchy_names:
		capital_barony_terrain = get_capital_barony_terrain(name)
		#print('duchy: '+name+', capital terrain: '+capital_barony_terrain)
		if (capital_barony_terrain == 'jungle'):
			print(name)
			jungle.append(name)
	# print(jungle)
	return jungle """


def get_duchies_with_these_terrains(terrains):
	matches = []
	for name in duchy_names:
		capital_barony_terrain = get_capital_barony_terrain(name)
		# print('duchy: '+name+', capital terrain: '+capital_barony_terrain)
		if (capital_barony_terrain in terrains):
			# print(name)
			matches.append(name)
	# print(jungle)
	return matches


def find_de_jure_kingdom_of_duchy(duchy_name):
	for name in secondary_level_title_names:
		if duchy_name in secondary_level_titles[name].keys():
			return name
	return 'Not found'


def find_de_jure_empire_of_kingdom(kingdom_name):
	for name in top_level_title_names:
		if kingdom_name in top_level_titles[name].keys():
			return name
	return 'Not found'


def find_de_jure_empire_of_duchy(duchy_name):
	for name in secondary_level_title_names:
		if duchy_name in secondary_level_titles[name].keys():
			return find_de_jure_empire_of_kingdom(name)
	return 'Not found'


jungles = get_duchies_with_terrain_capitals('jungle')
# print(jungles)
jungle_dict = {}
jungles_per_empire = {}
# print(duchy_titles['d_haritanaka'])
for name in jungles:
	kingdom_name = find_de_jure_kingdom_of_duchy(name)
	empire_name = find_de_jure_empire_of_duchy(name)
	jungle_dict[name] = {}
	num_counties = duchy_titles[name]['num_counties']
	jungle_dict[name]['num_counties'] = num_counties
	jungle_dict[name]['kingdom'] = kingdom_name
	if empire_name not in jungles_per_empire:
		jungles_per_empire[empire_name] = {'empire': empire_name}
	jungles_per_empire[empire_name][name] = {
		'duchy': name, 'counties': num_counties}
# print(jungle_dict)
for name in jungles_per_empire.keys():
	print(jungles_per_empire[name])

camelry_terrains = ['desert', 'desert_mountains', 'floodplains', 'oasis']
camelries = get_duchies_with_these_terrains(camelry_terrains)
# print(camelries)
camelry_dict = {}
camelries_by_counties = {}
camelries_by_empire = {}
for name in camelries:
	empire_name = find_de_jure_empire_of_duchy(name)
	camelry_dict[name] = {}
	camelry_dict[name]['num_counties'] = duchy_titles[name]['num_counties']
	camelry_dict[name]['empire'] = empire_name
	if str(duchy_titles[name]['num_counties']) not in camelries_by_counties.keys():
		camelries_by_counties[str(duchy_titles[name]['num_counties'])] = {}
	camelries_by_counties[str(duchy_titles[name]['num_counties'])][name] = {}
	camelries_by_counties[str(
		duchy_titles[name]['num_counties'])][name]['empire'] = empire_name
	if empire_name not in camelries_by_empire.keys():
		camelries_by_empire[empire_name] = {'name': empire_name}
		camelries_by_empire[empire_name]['num_duchies'] = 0
		camelries_by_empire[empire_name]['duchies'] = {}
	camelries_by_empire[empire_name]['num_duchies'] += 1
	camelries_by_empire[empire_name]['duchies'][name] = {
		'num_counties': duchy_titles[name]['num_counties']}
# print(camelry_dict)
# print(camelries_by_counties)

""" for n in range(2, 8):
	print(n)
	print(camelries_by_counties[str(n)])

for name in camelries_by_empire.keys():
	print(camelries_by_empire[name]) """

two_county_camelries = {}
three_and_four_county_camelries = {}
two_county_camelries_by_empire = {}
three_and_four_county_camelries_by_empire = {}
for name in camelries:
	empire_name = find_de_jure_empire_of_duchy(name)
	kingdom_name = find_de_jure_kingdom_of_duchy(name)
	num_counties = duchy_titles[name]['num_counties']
	if num_counties == 2:
		two_county_camelries[name] = {'empire': empire_name}
		if empire_name not in two_county_camelries_by_empire.keys():
			two_county_camelries_by_empire[empire_name] = {'num_duchies': 0}
		two_county_camelries_by_empire[empire_name][name] = {
			'counties': num_counties, 'kingdom': kingdom_name}
		two_county_camelries_by_empire[empire_name]['num_duchies'] += 1
	elif num_counties &lt; 5:
		if empire_name not in three_and_four_county_camelries_by_empire.keys():
			three_and_four_county_camelries_by_empire[empire_name] = {
				'num_duchies': 0}
		three_and_four_county_camelries[name] = {'empire': empire_name}
		three_and_four_county_camelries_by_empire[empire_name][name] = {
			'counties': num_counties, 'kingdom': kingdom_name}
		three_and_four_county_camelries_by_empire[empire_name]['num_duchies'] += 1

for name in two_county_camelries_by_empire:
	print(name)
	print(two_county_camelries_by_empire[name])
for name in three_and_four_county_camelries_by_empire:
	print(name)
	print(three_and_four_county_camelries_by_empire[name])


def find_by_terrain(target):

	target_terrains = get_duchies_with_these_terrains(target)
	target_terrain_dict = {}
	target_terrains_by_counties = {}
	target_terrains_by_empire = {}
	for name in target_terrains:
		empire_name = find_de_jure_empire_of_duchy(name)
		target_terrain_dict[name] = {}
		target_terrain_dict[name]['num_counties'] = duchy_titles[name]['num_counties']
		target_terrain_dict[name]['empire'] = empire_name
		if str(duchy_titles[name]['num_counties']) not in target_terrains_by_counties.keys():
			target_terrains_by_counties[str(
				duchy_titles[name]['num_counties'])] = {}
		target_terrains_by_counties[str(
			duchy_titles[name]['num_counties'])][name] = {}
		target_terrains_by_counties[str(
			duchy_titles[name]['num_counties'])][name]['empire'] = empire_name
		if empire_name not in target_terrains_by_empire.keys():
			target_terrains_by_empire[empire_name] = {'name': empire_name}
			target_terrains_by_empire[empire_name]['num_duchies'] = 0
			target_terrains_by_empire[empire_name]['duchies'] = {}
		target_terrains_by_empire[empire_name]['num_duchies'] += 1
		target_terrains_by_empire[empire_name]['duchies'][name] = {
			'num_counties': duchy_titles[name]['num_counties']}

	two_county_target_terrains = {}
	three_and_four_county_target_terrains = {}
	two_county_target_terrains_by_empire = {}
	three_and_four_county_target_terrains_by_empire = {}
	for name in target_terrains:
		empire_name = find_de_jure_empire_of_duchy(name)
		kingdom_name = find_de_jure_kingdom_of_duchy(name)
		num_counties = duchy_titles[name]['num_counties']
		if num_counties &lt;= 2:
			two_county_target_terrains[name] = {'empire': empire_name}
			if empire_name not in two_county_target_terrains_by_empire.keys():
				two_county_target_terrains_by_empire[empire_name] = {
					'num_duchies': 0}
			two_county_target_terrains_by_empire[empire_name][name] = {
				'counties': num_counties, 'kingdom': kingdom_name}
			two_county_target_terrains_by_empire[empire_name]['num_duchies'] += 1
		elif num_counties &lt; 5:
			if empire_name not in three_and_four_county_target_terrains_by_empire.keys():
				three_and_four_county_target_terrains_by_empire[empire_name] = {
					'num_duchies': 0}
			three_and_four_county_target_terrains[name] = {
				'empire': empire_name}
			three_and_four_county_target_terrains_by_empire[empire_name][name] = {
				'counties': num_counties, 'kingdom': kingdom_name}
			three_and_four_county_target_terrains_by_empire[empire_name]['num_duchies'] += 1

	print('TWO COUNTIES')
	for name in two_county_target_terrains_by_empire:
		print(name)
		print(two_county_target_terrains_by_empire[name])
	print('THREE AND FOUR COUNTIES')
	for name in three_and_four_county_target_terrains_by_empire:
		print(name)
		print(three_and_four_county_target_terrains_by_empire[name])
floodplains = ['floodplains']
find_by_terrain(floodplains)</code></pre>
								</div>
								<br>Regardless, the script does its job. Though it can only find you jungles, it doesn't
								know you can only build elephantries in India and South East
								Asia, not Africa.
								</p>
							</div>
							<!-- accordion -->
						</div>
					</div>

				</div>
			</div>
		</div>
		<div class="row gx-3">
			<div class="col dark-purple p-2" id="bot-row">
				BOTTOM ROW
			</div>
		</div>
	</div>
</body>

</html>